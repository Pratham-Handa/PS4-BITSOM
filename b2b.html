<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTrust | Packaging Sustainability Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Animation for results fading in */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Skeleton loader animation */
        .skeleton {
            background-color: #e2e8f0;
            border-radius: 0.5rem;
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            50% { opacity: .5; }
        }
         /* Styles for side menu transition */
        #side-menu {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-slate-800 transition-colors duration-300">

    <!-- Side Menu (Hidden by default) -->
    <div id="menu-overlay" class="fixed inset-0 bg-black/50 z-20 hidden"></div>
    <div id="side-menu" class="fixed top-0 left-0 h-full w-72 bg-white shadow-xl z-30 transform -translate-x-full">
        <div class="p-4">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center space-x-2">
                    <svg class="h-8 w-8 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 10.5h.375c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125v-2.25c0-.621.504-1.125 1.125-1.125H18.75M19.5 10.5v.15c0 .597-.237 1.17-.659 1.591l-5.432 5.432a2.25 2.25 0 01-1.591.659h-.152a2.25 2.25 0 01-1.591-.659l-5.432-5.432a2.25 2.25 0 01-.659-1.591v-.152a2.25 2.25 0 01.659-1.591l5.432-5.432a2.25 2.25 0 011.591-.659h.152a2.25 2.25 0 011.591.659l5.432 5.432c.422.422.659.994.659 1.591v.15z" /></svg>
                    <span class="text-xl font-bold text-slate-800">EcoTrust</span>
                </div>
                <button id="close-menu-btn" class="p-2 rounded-full hover:bg-slate-100">
                    <svg class="h-6 w-6 text-slate-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <nav class="flex flex-col space-y-2">
                <a href="index.html" class="flex items-center space-x-3 p-3 text-slate-600 hover:bg-slate-100 rounded-lg font-medium">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>Recycling Checker</span>
                </a>
                <a href="b2b.html" class="flex items-center space-x-3 p-3 bg-emerald-50 text-emerald-700 rounded-lg font-semibold">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.05a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V8.25a2.25 2.25 0 012.25-2.25h15a2.25 2.25 0 012.25 2.25v4.05m-2.25 0h-15m15 0v-4.05a2.25 2.25 0 00-2.25-2.25h-15a2.25 2.25 0 00-2.25 2.25V20.25a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0020.25 18v-3.75m-15.75 0h15.75" /></svg>
                    <span>For Businesses (B2B)</span>
                </a>
            </nav>
        </div>
    </div>

    <div class="container mx-auto p-4 max-w-4xl">
        <!-- Header -->
        <header class="w-full flex items-center justify-between p-2 mb-4">
            <div class="flex items-center space-x-4">
                <button id="open-menu-btn" class="p-2 rounded-full hover:bg-slate-100">
                    <svg class="h-6 w-6 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
                </button>
                <h1 class="text-2xl font-bold text-slate-800">B2B Dashboard</h1>
            </div>
        </header>

        <!-- Main Content -->
        <main class="w-full space-y-8">
            <!-- Controls -->
             <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-slate-900 mb-1">Analyze Packaging</h2>
                <p class="text-slate-500 mb-6">Select a material and city to generate a full sustainability report.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div class="md:col-span-1">
                        <label for="material-select" class="block text-sm font-medium text-slate-700 mb-1.5">Packaging Material</label>
                        <select id="material-select" class="w-full p-3 bg-white border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"></select>
                    </div>
                    <div>
                        <label for="city-input" class="block text-sm font-medium text-slate-700 mb-1.5">City</label>
                        <input type="text" id="city-input" value="Mumbai" class="w-full p-3 bg-white border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" placeholder="e.g., Mumbai, Delhi...">
                    </div>
                    <button id="analyze-btn" class="w-full bg-emerald-500 text-white font-semibold py-3 px-4 rounded-lg hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 shadow-sm transition-transform active:scale-[0.98] flex items-center justify-center">
                        Generate Report
                    </button>
                </div>
            </div>

            <!-- Results Column -->
            <div id="results-column">
                <!-- Initial Empty State -->
                <div id="empty-state" class="text-center p-12 bg-white/60 border-2 border-dashed border-slate-300 rounded-2xl">
                    <svg class="mx-auto h-12 w-12 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 100 15 7.5 7.5 0 000-15zM21 21l-5.197-5.197" /></svg>
                    <h3 class="mt-4 text-lg font-semibold text-slate-800">Your report will appear here</h3>
                    <p class="mt-1 text-slate-500">Start by selecting a material and city to analyze.</p>
                </div>
                
                <!-- Skeleton Loader -->
                <div id="loading-state" class="hidden space-y-6">
                    <div class="skeleton w-full h-24"></div>
                    <div class="skeleton w-full h-48"></div>
                    <div class="skeleton w-full h-64"></div>
                </div>
                
                <!-- Error Message -->
                <div id="error-container" class="hidden text-center p-6 bg-red-100 text-red-800 rounded-2xl border border-red-200"></div>

                <!-- Results Container -->
                <div id="results-container" class="hidden space-y-6"></div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const materialSelect = document.getElementById('material-select');
    const cityInput = document.getElementById('city-input');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultsContainer = document.getElementById('results-container');
    const errorContainer = document.getElementById('error-container');
    const emptyState = document.getElementById('empty-state');
    const loadingState = document.getElementById('loading-state');
    const openMenuBtn = document.getElementById('open-menu-btn');
    const closeMenuBtn = document.getElementById('close-menu-btn');
    const sideMenu = document.getElementById('side-menu');
    const menuOverlay = document.getElementById('menu-overlay');

    // --- Config ---
    const API_BASE_URL = "http://127.0.0.1:5000";
    const materials = ["PET Bottle", "HDPE Jug", "LDPE Film", "PP Container", "Corrugated Cardboard", "Glass Jar", "Compostable PLA Cup"];

    // --- Menu Logic ---
    function openMenu() {
        menuOverlay.classList.remove('hidden');
        sideMenu.classList.remove('-translate-x-full');
    }
    function closeMenu() {
        menuOverlay.classList.add('hidden');
        sideMenu.classList.add('-translate-x-full');
    }
    openMenuBtn.addEventListener('click', openMenu);
    closeMenuBtn.addEventListener('click', closeMenu);
    menuOverlay.addEventListener('click', closeMenu);

    // --- Initialization ---
    materials.forEach(mat => {
        const option = document.createElement('option');
        option.value = mat;
        option.textContent = mat;
        materialSelect.appendChild(option);
    });

    // --- Event Listeners ---
    analyzeBtn.addEventListener('click', handleAnalysis);

    // --- Core Functions ---
    async function handleAnalysis() {
        const materialName = materialSelect.value;
        const cityName = cityInput.value;

        if (!cityName.trim()) {
            displayError("Please enter a city name.");
            return;
        }

        emptyState.classList.add('hidden');
        resultsContainer.classList.add('hidden');
        errorContainer.classList.add('hidden');
        toggleLoadingIndicator(true);

        try {
            const response = await fetch(`${API_BASE_URL}/api/analyze?material=${encodeURIComponent(materialName)}&city=${encodeURIComponent(cityName)}`);
            const data = await response.json();
            
            console.log("✅ Data received from backend:", data);

            if (!response.ok) throw new Error(data.error || `HTTP error! status: ${response.status}`);
            displayResults(data);

        } catch (error) {
            console.error("❌ Fetch error:", error);
            displayError(error.message);
        } finally {
            toggleLoadingIndicator(false);
        }
    }

    function toggleLoadingIndicator(isLoading) {
        if (isLoading) {
            loadingState.classList.remove('hidden');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>`;
        } else {
            loadingState.classList.add('hidden');
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'Generate Report';
        }
    }

    function displayError(message) {
        errorContainer.textContent = `⚠️ ${message}`;
        errorContainer.classList.remove('hidden');
        resultsContainer.classList.add('hidden');
    }

    function displayResults(data) {
        resultsContainer.innerHTML = ''; 
        
        const reportParts = generateResultsHTML(data);
        reportParts.forEach(partHTML => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = partHTML.trim();
            resultsContainer.appendChild(tempDiv.firstChild);
        });

        resultsContainer.classList.remove('hidden');
        resultsContainer.classList.add('fade-in');
    }
    
    function generateResultsHTML(data) {
        const { outcome, notes } = data.localized_outcome;
        
        const getOutcomeStyles = (outcomeStr) => {
            if (outcomeStr.includes('Widely')) {
                return { 
                    iconPath: 'M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
                    bgColor: 'bg-green-100',
                    textColor: 'text-green-500'
                };
            }
            if (outcomeStr.includes('Moderately') || outcomeStr.includes('Limited')) {
                return {
                    iconPath: 'M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z',
                    bgColor: 'bg-yellow-100',
                    textColor: 'text-yellow-500'
                };
            }
            if (outcomeStr.includes('Not')) {
                 return {
                    iconPath: 'M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
                    bgColor: 'bg-red-100',
                    textColor: 'text-red-500'
                };
            }
            return {
                iconPath: 'M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442l.745 1.49a1 1 0 01-1.789.894l-1.49-2.981.007-.006-.007-.005-1.49 2.981a1 1 0 11-1.789-.894l.744-1.492a3.375 3.375 0 01-.67-.442c-1.172-1.025-1.172-2.687 0-3.712z',
                bgColor: 'bg-slate-100',
                textColor: 'text-slate-500'
            };
        };
        
        const styles = getOutcomeStyles(outcome);
        const outcomeHTML = `
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <p class="text-sm font-semibold text-slate-500 mb-2">Recyclability in ${data.query.city}</p>
                <div class="flex items-center space-x-4">
                    <div class="flex-shrink-0 ${styles.textColor} ${styles.bgColor} p-3 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="${styles.iconPath}" /></svg>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-slate-800">${outcome}</h3>
                        <p class="text-slate-600">${notes}</p>
                    </div>
                </div>
            </div>`;

        const icons = {
            esg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.657 7.343A8 8 0 0117.657 18.657z" /><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z" /></svg>`,
            marketing: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-fuchsia-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.82m5.84-2.56a12.025 12.025 0 01-4.132 4.04m2.46-4.04a6 6 0 01-7.38-5.84m2.56 5.84a12.025 12.025 0 01-4.04-4.132m4.04 2.46a6 6 0 015.84-7.38m-5.84 2.56a12.025 12.025 0 014.132-4.04m-2.46 4.04a6 6 0 017.38 5.84m-2.56-5.84a12.025 12.025 0 014.04 4.132" /></svg>`,
            investor: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" /><path stroke-linecap="round" stroke-linejoin="round" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" /></svg>`,
            compliance: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>`,
            plus: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>`,
            minus: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" /></svg>`,
        };

        const alternativesListHTML = data.sustainable_alternatives.length > 0
            ? data.sustainable_alternatives.map(alt => {
                const pros = alt.pros.map(p => `<li class="flex items-start space-x-2">${icons.plus} <span>${p}</span></li>`).join('');
                const cons = alt.cons.map(c => `<li class="flex items-start space-x-2">${icons.minus} <span>${c}</span></li>`).join('');
                return `
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <h4 class="font-bold text-lg text-emerald-700">${alt.alt_name}</h4>
                        <p class="text-sm text-slate-500 mb-3">Estimated Cost Impact: <span class="font-semibold">${alt.cost_factor}x</span></p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                            <ul class="space-y-2 text-slate-700">${pros}</ul>
                            <ul class="space-y-2 text-slate-700">${cons}</ul>
                        </div>
                    </div>`;
            }).join('')
            : `<p class="text-slate-500 p-4">No specific alternatives listed for this material in our database.</p>`;

        const alternativesCardHTML = `
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold mb-4">Recommended Sustainable Alternatives</h3>
                <div class="space-y-4">${alternativesListHTML}</div>
            </div>`;

        const insightCard = (icon, title, content) => `
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex items-start space-x-4">
                <div class="flex-shrink-0">${icon}</div>
                <div>
                    <h4 class="font-bold text-slate-800">${title}</h4>
                    <div class="text-sm text-slate-600 mt-1">${content}</div>
                </div>
            </div>`;
        
        const esgContent = data.strategic_insights.esg_reporting_points.map(p => `<div class="mt-2"><p class="font-semibold">${p.action}</p><p class="text-xs text-blue-600">${p.sdg_alignment}</p></div>`).join('');
        const complianceContent = data.compliance_updates.national_regulations.map(r => `<div class="mt-2"><p class="font-semibold">${r.name}</p><p class="text-xs text-slate-500">${r.relevance}</p></div>`).join('');
        
        const insightsHTML = `
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold mb-4">Strategic Insights Dashboard</h3>
                <div class="space-y-4">
                    ${insightCard(icons.esg, 'ESG & SDG Alignment', esgContent)}
                    ${insightCard(icons.marketing, 'Marketing & Brand Image', `<p>${data.strategic_insights.marketing_advantage}</p>`)}
                    ${insightCard(icons.investor, 'Investor Relations', `<p>${data.strategic_insights.investor_relations}</p>`)}
                    ${insightCard(icons.compliance, 'Compliance & Regulations', complianceContent)}
                </div>
            </div>`;

        return [outcomeHTML, alternativesCardHTML, insightsHTML];
    }
});
</script>

</body>
</html>

