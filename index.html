<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTrust | Recycling Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif;
        }
        .result-card-enter {
            animation: popIn 0.4s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
        }
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        /* Styles for side menu transition */
        #side-menu {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-50">

    <!-- Side Menu (Hidden by default) -->
    <div id="menu-overlay" class="fixed inset-0 bg-black/50 z-20 hidden"></div>
    <div id="side-menu" class="fixed top-0 left-0 h-full w-72 bg-white shadow-xl z-30 transform -translate-x-full">
        <div class="p-4">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center space-x-2">
                    <svg class="h-8 w-8 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 10.5h.375c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125v-2.25c0-.621.504-1.125 1.125-1.125H18.75M19.5 10.5v.15c0 .597-.237 1.17-.659 1.591l-5.432 5.432a2.25 2.25 0 01-1.591.659h-.152a2.25 2.25 0 01-1.591-.659l-5.432-5.432a2.25 2.25 0 01-.659-1.591v-.152a2.25 2.25 0 01.659-1.591l5.432-5.432a2.25 2.25 0 011.591-.659h.152a2.25 2.25 0 011.591.659l5.432 5.432c.422.422.659.994.659 1.591v.15z" /></svg>
                    <span class="text-xl font-bold text-slate-800">EcoTrust</span>
                </div>
                <button id="close-menu-btn" class="p-2 rounded-full hover:bg-slate-100">
                    <svg class="h-6 w-6 text-slate-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <nav class="flex flex-col space-y-2">
                <a href="index.html" class="flex items-center space-x-3 p-3 bg-emerald-50 text-emerald-700 rounded-lg font-semibold">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>Recycling Checker</span>
                </a>
                <a href="b2b.html" class="flex items-center space-x-3 p-3 text-slate-600 hover:bg-slate-100 rounded-lg font-medium">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.05a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V8.25a2.25 2.25 0 012.25-2.25h15a2.25 2.25 0 012.25 2.25v4.05m-2.25 0h-15m15 0v-4.05a2.25 2.25 0 00-2.25-2.25h-15a2.25 2.25 0 00-2.25 2.25V20.25a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0020.25 18v-3.75m-15.75 0h15.75" /></svg>
                    <span>For Businesses (B2B)</span>
                </a>
            </nav>
        </div>
    </div>

    <div class="container mx-auto p-4 max-w-lg min-h-screen flex flex-col items-center">
        
        <!-- Header -->
        <header class="w-full flex items-center justify-between p-2 mb-4">
             <div class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 10.5h.375c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125v-2.25c0-.621.504-1.125 1.125-1.125H18.75M19.5 10.5v.15c0 .597-.237 1.17-.659 1.591l-5.432 5.432a2.25 2.25 0 01-1.591.659h-.152a2.25 2.25 0 01-1.591-.659l-5.432-5.432a2.25 2.25 0 01-.659-1.591v-.152a2.25 2.25 0 01.659-1.591l5.432-5.432a2.25 2.25 0 011.591-.659h.152a2.25 2.25 0 011.591.659l5.432 5.432c.422.422.659.994.659 1.591v.15z" /></svg>
                <h1 class="text-2xl font-bold text-slate-800">EcoTrust</h1>
            </div>
            <button id="open-menu-btn" class="p-2 rounded-full hover:bg-slate-100">
                <svg class="h-6 w-6 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
            </button>
        </header>

        <div class="w-full flex-grow flex flex-col justify-center">
            <div class="text-center mb-6">
                 <h2 class="text-3xl font-bold text-slate-800">Is this recyclable?</h2>
                 <p class="text-slate-500 mt-1">Get fast, local answers for India.</p>
            </div>
            
            <!-- Input Card -->
            <main class="bg-white p-6 rounded-2xl shadow-lg w-full">
                <div class="space-y-4">
                    <div>
                        <label for="material-select" class="block text-sm font-medium text-slate-700 mb-1.5">What are you recycling?</label>
                        <select id="material-select" class="w-full p-3 bg-white border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"></select>
                    </div>
                    <div>
                        <label for="city-input" class="block text-sm font-medium text-slate-700 mb-1.5">Where are you?</label>
                        <input type="text" id="city-input" value="Mumbai" class="w-full p-3 bg-white border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" placeholder="Enter your city...">
                    </div>
                    <button id="analyze-btn" class="w-full bg-emerald-500 text-white font-semibold py-3 px-4 rounded-lg hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 shadow-sm transition-transform active:scale-[0.98] flex items-center justify-center">
                        Check Now
                    </button>
                </div>
            </main>

            <!-- Result Area -->
            <div id="result-area" class="mt-8 min-h-[200px] w-full">
                <!-- Loading State -->
                <div id="loading-state" class="hidden text-center py-8">
                    <div class="w-8 h-8 border-4 border-emerald-200 border-t-emerald-500 rounded-full animate-spin mx-auto"></div>
                    <p class="mt-2 text-slate-500">Checking local data...</p>
                </div>
                
                <!-- Error Message -->
                <div id="error-container" class="hidden text-center p-6 bg-red-100 text-red-800 rounded-2xl border border-red-200"></div>

                <!-- Results Container -->
                <div id="results-container"></div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const materialSelect = document.getElementById('material-select');
    const cityInput = document.getElementById('city-input');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultsContainer = document.getElementById('results-container');
    const errorContainer = document.getElementById('error-container');
    const loadingState = document.getElementById('loading-state');
    const openMenuBtn = document.getElementById('open-menu-btn');
    const closeMenuBtn = document.getElementById('close-menu-btn');
    const sideMenu = document.getElementById('side-menu');
    const menuOverlay = document.getElementById('menu-overlay');

    // --- Config ---
    const API_BASE_URL = "http://127.0.0.1:5000";
    const materials = ["PET Bottle", "HDPE Jug", "LDPE Film", "PP Container", "Corrugated Cardboard", "Glass Jar", "Compostable PLA Cup"];

    // --- Menu Logic ---
    function openMenu() {
        menuOverlay.classList.remove('hidden');
        sideMenu.classList.remove('-translate-x-full');
    }
    function closeMenu() {
        menuOverlay.classList.add('hidden');
        sideMenu.classList.add('-translate-x-full');
    }
    openMenuBtn.addEventListener('click', openMenu);
    closeMenuBtn.addEventListener('click', closeMenu);
    menuOverlay.addEventListener('click', closeMenu);

    // --- Initialization ---
    materials.forEach(mat => {
        const option = document.createElement('option');
        option.value = mat;
        option.textContent = mat;
        materialSelect.appendChild(option);
    });

    // --- Event Listeners ---
    analyzeBtn.addEventListener('click', handleAnalysis);

    // --- Core Functions ---
    async function handleAnalysis() {
        const materialName = materialSelect.value;
        const cityName = cityInput.value;

        if (!cityName.trim()) {
            displayError("Please enter a city name.");
            return;
        }

        resultsContainer.innerHTML = '';
        errorContainer.classList.add('hidden');
        loadingState.classList.remove('hidden');
        analyzeBtn.disabled = true;

        try {
            const response = await fetch(`${API_BASE_URL}/api/analyze?material=${encodeURIComponent(materialName)}&city=${encodeURIComponent(cityName)}`);
            const data = await response.json();
            
            if (!response.ok) throw new Error(data.error || `HTTP error! status: ${response.status}`);
            displayResult(data);

        } catch (error) {
            console.error("❌ Fetch error:", error);
            displayError(error.message);
        } finally {
            loadingState.classList.add('hidden');
            analyzeBtn.disabled = false;
        }
    }

    function displayError(message) {
        errorContainer.textContent = `⚠️ ${message}`;
        errorContainer.classList.remove('hidden');
    }

    function displayResult(data) {
        const { outcome, notes } = data.localized_outcome;
        
        const getOutcomeStyles = (outcomeStr) => {
            if (outcomeStr.includes('Widely')) {
                return {
                    title: "Yes!",
                    icon: 'M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
                    bgColor: 'bg-green-500',
                    textColor: 'text-white'
                };
            }
            if (outcomeStr.includes('Moderately') || outcomeStr.includes('Limited')) {
                return {
                    title: "Maybe",
                    icon: 'M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z',
                    bgColor: 'bg-yellow-500',
                    textColor: 'text-white'
                };
            }
            if (outcomeStr.includes('Not')) {
                 return {
                    title: "No",
                    icon: 'M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
                    bgColor: 'bg-red-500',
                    textColor: 'text-white'
                };
            }
            return {
                title: "Uncertain",
                icon: 'M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442l.745 1.49a1 1 0 01-1.789.894l-1.49-2.981.007-.006-.007-.005-1.49 2.981a1 1 0 11-1.789-.894l.744-1.492a3.375 3.375 0 01-.67-.442c-1.172-1.025-1.172-2.687 0-3.712z',
                bgColor: 'bg-slate-500',
                textColor: 'text-white'
            };
        };

        const styles = getOutcomeStyles(outcome);

        const resultHTML = `
            <div class="p-6 rounded-2xl shadow-xl text-center ${styles.bgColor} ${styles.textColor} result-card-enter">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-16 h-16 mx-auto mb-4 opacity-80">
                    <path stroke-linecap="round" stroke-linejoin="round" d="${styles.icon}" />
                </svg>
                <h2 class="text-4xl font-extrabold mb-2">${styles.title}</h2>
                <p class="text-lg font-semibold mb-3">${outcome} in ${data.query.city}</p>
                <p class="text-sm opacity-90">${notes}</p>
            </div>
        `;
        
        resultsContainer.innerHTML = resultHTML;
    }
});
</script>

</body>
</html>

